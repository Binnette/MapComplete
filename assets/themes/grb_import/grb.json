{
  "id": "grb",
  "title": {
    "nl": "GRB Fixup"
  },
  "shortDescription": {
    "nl": "Grb Fixup"
  },
  "description": {
    "nl": "GRB Fixup"
  },
  "language": [
    "nl"
  ],
  "maintainer": "",
  "icon": "./assets/svg/bug.svg",
  "version": "0",
  "startLat": 51.2132,
  "startLon": 3.231,
  "startZoom": 14,
  "widenFactor": 2,
  "socialImage": "",
  "clustering": {
    "maxZoom": 15
  },
  "layers": [
    {
      "id": "OSM-buildings",
      "name": "All OSM-buildings",
      "source": {
        "osmTags": "building~*",
        "maxCacheAge": 0
      },
      "minzoom": 16,
      "mapRendering": [
        {
          "width": {
            "render": "2"
          },
          "color": {
            "render": "#00c",
            "mappings": [
              {
                "if": "building=house",
                "then": "#a00"
              },
              {
                "if": "building=shed",
                "then": "#563e02"
              },
              {
                "if": {
                  "or": [
                    "building=garage",
                    "building=garages"
                  ]
                },
                "then": "#f9bfbb"
              },
              {
                "if": "building=yes",
                "then": "#0774f2"
              }
            ]
          }
        }
      ],
      "title": "OSM-gebouw",
      "tagRenderings": [
        "all_tags"
      ]
    },
    {
      "id": "All OSM objects",
      "name": "All OSM Objects",
      "source": {
        "osmTags": {
          "and": [
            "id~*",
            "landuse=",
            "place=",
            "disused:power=",
            "power=",
            "type!=boundary",
            "boundary=",
            {
              "or": [
                "level=",
                "level=0"
              ]
            },
            {
              "or": [
                "layer=0",
                "layer="
              ]
            }
          ]
        },
        "maxCacheAge": 0
      },
      "minzoom": 18,
      "mapRendering": [
        {
          "color": {
            "render": "#00c"
          },
          "width": {
            "render": "1"
          }
        }
      ],
      "title": {
        "render": {
          "*": "OSM-Object"
        }
      },
      "tagRenderings": [
        "all_tags"
      ]
    },
    {
      "id": "osm-fixmes",
      "name": {
        "nl": "Fixmes op gebouwen"
      },
      "minzoom": 21,
      "source": {
        "maxCacheAge": 0,
        "osmTags": {
          "and": [
            "fixme~*",
            "building~*"
          ]
        }
      },
      "calculatedTags": [
        "_grbNumber=(feat.properties.fixme?.match(/GRB thinks that this has number ([^;]+)/ ) ?? ['','none']) [1]"
      ],
      "title": {
        "render": {
          "nl": "{addr:street} {addr:housenumber}"
        },
        "mappings": [
          {
            "if": {
              "and": [
                "fixme~*"
              ]
            },
            "then": {
              "nl": "{fixme}"
            }
          }
        ]
      },
      "description": {
        "nl": "Dit gebouw heeft een foutmelding"
      },
      "tagRenderings": [
        {
          "id": "grb-housenumber",
          "render": {
            "nl": "Het huisnummer is <b>{addr:housenumber}</b>"
          },
          "question": {
            "nl": "Wat is het huisnummer?"
          },
          "freeform": {
            "key": "addr:housenumber"
          },
          "mappings": [
            {
              "if": {
                "and": [
                  "not:addr:housenumber=yes",
                  "addr:housenumber="
                ]
              },
              "then": {
                "nl": "Geen huisnummer"
              }
            },
            {
              "if": {
                "and": [
                  "addr:housenumber:={_grbNumber}",
                  "fixme="
                ]
              },
              "then": "Het huisnummer is <b>{_grbNumber}</b>, wat overeenkomt met het GRB",
              "hideInAnswer": {
                "or": [
                  "_grbNumber=",
                  "_grbNumber=none",
                  "_grbNumber=no number"
                ]
              }
            },
            {
              "if": {
                "and": [
                  "addr:housenumber=",
                  "not:addr:housenumber=yes",
                  "fixme="
                ]
              },
              "then": "Dit gebouw heeft geen nummer, net zoals in het GRB",
              "hideInAnswer": "_grbNumber!=no number"
            }
          ]
        },
        {
          "id": "grb-unit",
          "question": "Wat is de wooneenheid-aanduiding?",
          "render": {
            "nl": "De wooneenheid-aanduiding is <b>{addr:unit}</b> "
          },
          "freeform": {
            "key": "addr:unit"
          },
          "mappings": [
            {
              "if": "addr:unit=",
              "then": "Geen wooneenheid-nummer"
            }
          ]
        },
        {
          "id": "grb-street",
          "render": {
            "nl": "De straat is <b>{addr:street}</b>"
          },
          "freeform": {
            "key": "addr:street"
          },
          "question": {
            "nl": "Wat is de straat?"
          }
        },
        {
          "id": "grb-fixme",
          "render": {
            "nl": "De fixme is <b>{fixme}</b>"
          },
          "question": {
            "nl": "Wat zegt de fixme?"
          },
          "freeform": {
            "key": "fixme"
          },
          "mappings": [
            {
              "if": {
                "and": [
                  "fixme="
                ]
              },
              "then": {
                "nl": "Geen fixme"
              }
            }
          ]
        },
        {
          "id": "grb-min-level",
          "render": {
            "nl": "Dit gebouw begint maar op de {building:min_level} verdieping"
          },
          "question": {
            "nl": "Hoeveel verdiepingen ontbreken?"
          },
          "freeform": {
            "key": "building:min_level",
            "type": "pnat"
          }
        }
      ],
      "mapRendering": [
        {
          "location": [
            "point",
            "centroid"
          ],
          "label": {
            "mappings": [
              {
                "if": "addr:housenumber~*",
                "then": "<div style='background-color: white; font: large; width: 1.5em; height: 1.5em; border-radius: 100%'>{addr:housenumber}</div>"
              }
            ]
          },
          "iconSize": {
            "render": "40,40,center"
          }
        },
        {
          "dashes": "2 2",
          "color": {
            "render": "#00f"
          },
          "width": {
            "render": "2"
          }
        }
      ]
    },
    {
      "id": "crab-addresses 2021-10-26",
      "source": {
        "osmTags": "HUISNR~*",
        "geoJson": "https://raw.githubusercontent.com/pietervdvn/pietervdvn.github.io/master/CRAB_2021_10_26/tile_{z}_{x}_{y}.geojson",
        "#geoJson": "https://pietervdvn.github.io/CRAB_2021_10_26/tile_{z}_{x}_{y}.geojson",
        "geoJsonZoomLevel": 18,
        "maxCacheAge": 0
      },
      "minzoom": 16,
      "name": "CRAB-addressen",
      "title": "CRAB-adres",
      "mapRendering": [
        {
          "location": [
            "point"
          ],
          "icon": "circle:#bb3322",
          "iconSize": "15,15,center"
        }
      ],
      "calculatedTags": [
        "_embedded_in=feat.overlapWith('OSM-buildings').filter(f => f.feat.properties['addr:housenumber'] !== undefined)[0]?.feat?.properties ",
        "_embedding_nr=feat.get('_embedded_in')['addr:housenumber']",
        "_embedding_street=feat.get('_embedded_in')['addr:street']"
      ],
      "isShown": {
        "render": "yes",
        "mappings": [
          {
            "if": {
              "and": [
                "_embedding_nr:={HUISNR}",
                "_embedding_street:={STRAATNM}"
              ]
            },
            "then": "no"
          }
        ]
      },
      "tagRenderings": [
        {
          "id": "render_crab",
          "render": "Volgens het CRAB ligt hier <b>{STRAATNM}</b> {HUISNR} (label: {HNRLABEL})"
        },
        {
          "id": "render_embedded",
          "render": "Het omliggende object met addres heeft <b>{_embedding_street}</b> {_embedding_nr}",
          "condition": {
            "and": [
              "_embedding_street~*",
              "_embedding_nr~*"
            ]
          }
        },
        "all_tags",
        {
          "id": "import-button",
          "render": "{import_button(addr:street=$STRAATNM; addr:housenumber=$HUISNR)}"
        }
      ]
    },
    {
      "id": "grb-fixmes",
      "name": {
        "nl": "Fixmes op gebouwen"
      },
      "minzoom": 16,
      "source": {
        "maxCacheAge": 0,
        "osmTags": {
          "and": [
            "fixme~*",
            "building~*"
          ]
        }
      },
      "calculatedTags": [
        "_grbNumber=(feat.properties.fixme?.match(/GRB thinks that this has number ([^;]+)/ ) ?? ['','none']) [1]"
      ],
      "title": {
        "render": {
          "nl": "{addr:street} {addr:housenumber}"
        },
        "mappings": [
          {
            "if": {
              "and": [
                "fixme~*"
              ]
            },
            "then": {
              "nl": "{fixme}"
            }
          }
        ]
      },
      "description": {
        "nl": "Dit gebouw heeft een foutmelding"
      },
      "tagRenderings": [
        {
          "id": "grb-housenumber",
          "render": {
            "nl": "Het huisnummer is <b>{addr:housenumber}</b>"
          },
          "question": {
            "nl": "Wat is het huisnummer?"
          },
          "freeform": {
            "key": "addr:housenumber"
          },
          "mappings": [
            {
              "if": {
                "and": [
                  "not:addr:housenumber=yes",
                  "addr:housenumber="
                ]
              },
              "then": {
                "nl": "Geen huisnummer"
              }
            },
            {
              "if": {
                "and": [
                  "addr:housenumber:={_grbNumber}",
                  "fixme="
                ]
              },
              "then": "Het huisnummer is <b>{_grbNumber}</b>, wat overeenkomt met het GRB",
              "hideInAnswer": {
                "or": [
                  "_grbNumber=",
                  "_grbNumber=none",
                  "_grbNumber=no number"
                ]
              }
            },
            {
              "if": {
                "and": [
                  "addr:housenumber=",
                  "not:addr:housenumber=yes",
                  "fixme="
                ]
              },
              "then": "Dit gebouw heeft geen nummer, net zoals in het GRB",
              "hideInAnswer": "_grbNumber!=no number"
            }
          ]
        },
        {
          "id": "grb-unit",
          "question": "Wat is de wooneenheid-aanduiding?",
          "render": {
            "nl": "De wooneenheid-aanduiding is <b>{addr:unit}</b> "
          },
          "freeform": {
            "key": "addr:unit"
          },
          "mappings": [
            {
              "if": "addr:unit=",
              "then": "Geen wooneenheid-nummer"
            }
          ]
        },
        {
          "id": "grb-street",
          "render": {
            "nl": "De straat is <b>{addr:street}</b>"
          },
          "freeform": {
            "key": "addr:street"
          },
          "question": {
            "nl": "Wat is de straat?"
          }
        },
        {
          "id": "grb-fixme",
          "render": {
            "nl": "De fixme is <b>{fixme}</b>"
          },
          "question": {
            "nl": "Wat zegt de fixme?"
          },
          "freeform": {
            "key": "fixme"
          },
          "mappings": [
            {
              "if": {
                "and": [
                  "fixme="
                ]
              },
              "then": {
                "nl": "Geen fixme"
              }
            }
          ]
        },
        {
          "id": "grb-min-level",
          "render": {
            "nl": "Dit gebouw begint maar op de {building:min_level} verdieping"
          },
          "question": {
            "nl": "Hoeveel verdiepingen ontbreken?"
          },
          "freeform": {
            "key": "building:min_level",
            "type": "pnat"
          }
        }
      ],
      "mapRendering": [
        {
          "location": [
            "point",
            "centroid"
          ],
          "iconSize": {
            "render": "40,40,center"
          },
          "label": {
            "mappings": [
              {
                "if": "addr:housenumber~*",
                "then": "<div style='background-color: white; font: large; width: 1.5em; height: 1.5em; border-radius: 100%'>{addr:housenumber}</div>"
              }
            ]
          }
        },
        {
          "width": {
            "render": "2"
          },
          "color": {
            "render": "#00f"
          }
        }
      ]
    },
    {
      "id": "GRB",
      "source": {
        "osmTags": "HUISNR~*",
        "geoJson": "https://betadata.grbosm.site/grb?bbox={x_min},{y_min},{x_max},{y_max}",
        "geoJsonZoomLevel": 18,
        "mercatorCrs": true,
        "maxCacheAge": 0
      },
      "name": "GRB geometries",
      "title": "GRB outline",
      "minzoom": 16,
      "calculatedTags": [
        "_overlaps_with=feat.overlapWith('OSM-buildings').filter(f => f.overlap > 1 && feat.properties._surface - f.overlap < 5)[0] ?? null",
        "_osm_obj:source:ref=JSON.parse(feat.properties._overlaps_with)?.feat?.properties['source:geometry:ref']",
        "_osm_obj:source:date=JSON.parse(feat.properties._overlaps_with)?.feat?.properties['source:geometry:date'].replace(/\\//g, '-')",
        "_imported_osm_object_found= feat.properties['_osm_obj:source:ref'] == feat.properties['source:geometry:entity'] + '/' + feat.properties['source:geometry:oidn']",
        "_grb_date=feat.properties['source:geometry:date'].replace(/\\//g,'-')",
        "_imported_osm_still_fresh= feat.properties['_osm_obj:source:date'] == feat.properties._grb_date"
      ],
      "tagRenderings": [
        "all_tags"
      ],
      "isShown": {
        "render": "yes",
        "mappings": [
          {
            "if": {
              "and": [
                "_imported_osm_object_found=true",
                "_imported_osm_still_fresh=true"
              ]
            },
            "then": "no"
          }
        ]
      },
      "mapRendering": [
        {
          "color": {
            "render": "#00a",
            "mappings": [
              {
                "if": {
                  "and": [
                    "_imported_osm_object_found=true",
                    "_imported_osm_still_fresh=true"
                  ]
                },
                "then": "#0f0"
              }
            ]
          }
        }
      ]
    }
  ],
  "hideFromOverview": true,
  "defaultBackgroundId": "AGIVFlandersGRB",
  "overpassMaxZoom": 15,
  "osmApiTileSize": 17
}